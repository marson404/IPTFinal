import{a as J}from"./chunk-Q3S7IUFL.js";import{a as $}from"./chunk-FNBHHN2H.js";import{a as H}from"./chunk-JJSI5YBX.js";import{a as V,b as T,c as A,d as W,e as N,f as L,g as D,h as F,i as j,j as B,k as z,l as G,o as Q}from"./chunk-SWDTLJ4O.js";import{A as g,B as M,F as y,I as p,K as o,L as s,N as h,O as v,P as c,U as m,W as w,Y as q,Z as b,_ as x,ka as R,la as O,na as P,ra as k,s as d,t as u,ta as I,y as l}from"./chunk-RY5F4FTU.js";function U(a,i){if(a&1&&(o(0,"div",5),m(1),s()),a&2){let e=c();l(),w(" ",e.error," ")}}function X(a,i){a&1&&(o(0,"div",6),m(1," Loading... "),s())}function Y(a,i){if(a&1&&(o(0,"option",23),m(1),s()),a&2){let e=i.$implicit;p("value",e.email),l(),w(" ",e.email," ")}}function Z(a,i){if(a&1){let e=h();o(0,"button",28),v("click",function(){d(e);let t=c().index,r=c(2);return u(r.removeItem(t))}),m(1,"Remove"),s()}}function ee(a,i){if(a&1){let e=h();o(0,"div",24)(1,"input",25),x("ngModelChange",function(t){let r=d(e).$implicit;return b(r.name,t)||(r.name=t),u(t)}),s(),o(2,"input",26),x("ngModelChange",function(t){let r=d(e).$implicit;return b(r.quantity,t)||(r.quantity=t),u(t)}),s(),y(3,Z,2,0,"button",27),s()}if(a&2){let e=i.$implicit,n=i.index,t=c(2);l(),q("ngModel",e.name),p("name","itemName"+n),l(),q("ngModel",e.quantity),p("name","itemQty"+n),l(),p("ngIf",t.request.items.length>1)}}function te(a,i){if(a&1){let e=h();o(0,"form",7),v("ngSubmit",function(){d(e);let t=c();return u(t.save())}),o(1,"div",8)(2,"label",9),m(3,"Type *"),s(),o(4,"select",10),x("ngModelChange",function(t){d(e);let r=c();return b(r.request.type,t)||(r.request.type=t),u(t)}),o(5,"option",11),m(6,"Select Type"),s(),o(7,"option",12),m(8,"Equipment"),s(),o(9,"option",13),m(10,"Leave"),s(),o(11,"option",14),m(12,"Resources"),s()()(),o(13,"div",8)(14,"label",15),m(15,"Employee *"),s(),o(16,"select",16),x("ngModelChange",function(t){d(e);let r=c();return b(r.request.employee,t)||(r.request.employee=t),u(t)}),o(17,"option",11),m(18,"Select Employee"),s(),y(19,Y,2,2,"option",17),s()(),o(20,"div",8)(21,"label"),m(22,"Items *"),s(),y(23,ee,4,5,"div",18),o(24,"button",19),v("click",function(){d(e);let t=c();return u(t.addItem())}),m(25,"Add Item"),s()(),o(26,"div",20)(27,"button",21),v("click",function(){d(e);let t=c();return u(t.cancel())}),m(28,"Cancel"),s(),o(29,"button",22),m(30,"Save"),s()()()}if(a&2){let e=c();l(4),q("ngModel",e.request.type),l(12),q("ngModel",e.request.employee),l(3),p("ngForOf",e.activeEmployees),l(4),p("ngForOf",e.request.items)}}var K=class a{constructor(i,e,n,t,r){this.router=i;this.route=e;this.requestService=n;this.employeeService=t;this.workflowService=r}request={type:"",employee:"",items:[{name:"",quantity:1}]};loading=!1;error="";activeEmployees=[];ngOnInit(){this.loadActiveEmployees();let i=this.route.snapshot.params.id;i&&this.loadRequest(i)}loadActiveEmployees(){this.employeeService.getAllEmployees().subscribe({next:i=>{this.activeEmployees=i.filter(e=>e.status==="Active")},error:i=>{this.error="Error loading employees: "+i.message}})}loadRequest(i){this.loading=!0,this.requestService.getRequestById(i).subscribe({next:e=>{this.request={type:e.type,employee:e.employee_email,items:e.items.split(",").map(n=>{let t=n.match(/(.+)\s*\((\d+)\)/);return{name:t?t[1].trim():n.trim(),quantity:t?parseInt(t[2]):1}})},this.loading=!1},error:e=>{this.error="Error loading request: "+e.message,this.loading=!1}})}addItem(){this.request.items.push({name:"",quantity:1})}removeItem(i){this.request.items.splice(i,1)}getWorkflowType(i){switch(i){case"Equipment":return"Request Equipment Approval";case"Leave":return"Request Leave Approval";case"Resources":return"Request Resources Approval";default:return"Request Equipment Approval"}}save(){if(!this.request.type||!this.request.employee||this.request.items.some(r=>!r.name)){this.error="Please fill in all required fields";return}let i=this.route.snapshot.params.id,e=this.activeEmployees.find(r=>r.email===this.request.employee);if(!e){this.error="Selected employee not found";return}let n={type:this.request.type,employeeId:e.id,employeeEmail:this.request.employee,items:this.request.items.map(r=>`${r.name} (${r.quantity})`).join(", "),status:"Pending"};(i?this.requestService.updateRequest(i,{type:n.type,employee_id:n.employeeId,employee_email:n.employeeEmail,items:n.items,status:n.status}):this.requestService.createRequest(n)).subscribe({next:r=>{this.workflowService.getWorkflowsByEmployeeId(e.id).subscribe({next:C=>{let E=C.find(_=>_.request_id===r.id),f="";this.request.type==="Department Transfer"?f=`Transfer from ${e.department} to new department`:this.request.type==="Equipment"||this.request.type==="Resources"?f=`Requesting ${this.request.type} Approval`:this.request.type==="Leave"?f="Leave Request Approval":f=`${this.request.type} Process`;let S={employee_id:e.id,request_id:r.id,current_step:f,status:"Pending",request_type:this.request.type,request_items:n.items};E?this.workflowService.updateWorkflow(E.id,S).subscribe({next:()=>{this.router.navigate(["/requests"])},error:_=>{this.error="Error updating workflow: "+_.message}}):this.workflowService.createWorkflow(S).subscribe({next:()=>{this.router.navigate(["/requests"])},error:_=>{this.error="Error creating workflow: "+_.message}})},error:C=>{this.error="Error checking existing workflows: "+C.message}})},error:r=>{this.error="Error saving request: "+r.message}})}cancel(){this.router.navigate(["/requests"])}static \u0275fac=function(e){return new(e||a)(g(I),g(k),g(H),g($),g(J))};static \u0275cmp=M({type:a,selectors:[["app-edit-request"]],decls:7,vars:3,consts:[[1,"card"],[1,"card-header"],["class","alert alert-danger",4,"ngIf"],["class","loading-spinner",4,"ngIf"],["class","form",3,"ngSubmit",4,"ngIf"],[1,"alert","alert-danger"],[1,"loading-spinner"],[1,"form",3,"ngSubmit"],[1,"form-group"],["for","type"],["id","type","name","type","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","","disabled",""],["value","Equipment"],["value","Leave"],["value","Resources"],["for","employee"],["id","employee","name","employee","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","item-row",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-secondary","mt-2",3,"click"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],[3,"value"],[1,"item-row"],["type","text","placeholder","Item Name","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","number","min","1","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),m(3,"Edit Request"),s()(),y(4,U,2,1,"div",2)(5,X,2,0,"div",3)(6,te,31,4,"form",4),s()),e&2&&(l(4),p("ngIf",n.error),l(),p("ngIf",n.loading),l(),p("ngIf",!n.loading))},dependencies:[P,R,O,Q,L,j,B,V,D,F,T,A,G,z,N,W],styles:[".card[_ngcontent-%COMP%]{max-width:900px;margin:2rem auto;padding:2rem;background:#fff;border-radius:12px;box-shadow:0 4px 12px #0000001a}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid #e0e0e0;margin-bottom:2rem;padding-bottom:.5rem}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#222;font-size:1.75rem;font-weight:600}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#333}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;font-size:1rem;color:#333;background-color:#fff;border:1px solid #ccc;border-radius:8px;transition:border-color .2s ease,box-shadow .2s ease}.form-control[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none;box-shadow:0 0 0 3px #007bff26}.item-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;align-items:flex-start}.item-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{flex:1}.item-row[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:120px;flex:0 0 auto}.btn[_ngcontent-%COMP%]{padding:.6rem 1.2rem;font-size:1rem;border-radius:8px;cursor:pointer;border:none;font-weight:500;transition:background-color .2s ease}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#545b62}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c82333}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}.alert[_ngcontent-%COMP%]{padding:1rem;border-radius:8px;margin-bottom:1rem}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#666}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}@media (max-width: 600px){.card[_ngcontent-%COMP%]{padding:1rem}.item-row[_ngcontent-%COMP%]{flex-direction:column}.item-row[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:100%}}"]})};export{K as EditRequestComponent};
