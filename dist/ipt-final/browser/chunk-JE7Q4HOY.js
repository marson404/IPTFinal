import{a as B}from"./chunk-Q3S7IUFL.js";import{a as j}from"./chunk-FNBHHN2H.js";import{a as z}from"./chunk-JJSI5YBX.js";import{a as R,b as O,c as A,d as P,e as T,f as k,g as I,h as V,i as W,j as N,k as L,l as D,o as F}from"./chunk-SWDTLJ4O.js";import{A as g,B as h,F as f,I as d,K as r,L as o,N as q,O as _,P as c,U as s,W as C,Y as y,Z as b,_ as v,ka as w,la as E,na as S,s as p,t as u,ta as M,y as m}from"./chunk-RY5F4FTU.js";function $(a,i){if(a&1&&(r(0,"div",5),s(1),o()),a&2){let e=c();m(),C(" ",e.error," ")}}function G(a,i){a&1&&(r(0,"div",6),s(1,"Loading..."),o())}function H(a,i){if(a&1&&(r(0,"option",21),s(1),o()),a&2){let e=i.$implicit;d("value",e.email),m(),C(" ",e.email," ")}}function J(a,i){if(a&1){let e=q();r(0,"button",26),_("click",function(){p(e);let t=c().index,l=c(2);return u(l.removeItem(t))}),s(1," Remove "),o()}}function K(a,i){if(a&1){let e=q();r(0,"div",22)(1,"input",23),v("ngModelChange",function(t){let l=p(e).$implicit;return b(l.name,t)||(l.name=t),u(t)}),o(),r(2,"input",24),v("ngModelChange",function(t){let l=p(e).$implicit;return b(l.quantity,t)||(l.quantity=t),u(t)}),o(),f(3,J,2,0,"button",25),o()}if(a&2){let e=i.$implicit,n=i.index,t=c(2);m(),y("ngModel",e.name),d("name","itemName"+n),m(),y("ngModel",e.quantity),d("name","itemQty"+n),m(),d("ngIf",t.items.length>1)}}function U(a,i){if(a&1){let e=q();r(0,"form",7),_("ngSubmit",function(){p(e);let t=c();return u(t.save())}),r(1,"div",8)(2,"label"),s(3,"Type *"),o(),r(4,"select",9),v("ngModelChange",function(t){p(e);let l=c();return b(l.requestType,t)||(l.requestType=t),u(t)}),r(5,"option",10),s(6,"-- Select Type --"),o(),r(7,"option",11),s(8,"Leave"),o(),r(9,"option",12),s(10,"Resources"),o(),r(11,"option",13),s(12,"Equipment"),o()()(),r(13,"div",8)(14,"label"),s(15,"Employee *"),o(),r(16,"select",14),v("ngModelChange",function(t){p(e);let l=c();return b(l.selectedEmployee,t)||(l.selectedEmployee=t),u(t)}),r(17,"option",10),s(18,"-- Select Employee --"),o(),f(19,H,2,2,"option",15),o()(),r(20,"div",8)(21,"label"),s(22,"Items *"),o(),f(23,K,4,5,"div",16),r(24,"button",17),_("click",function(){p(e);let t=c();return u(t.addItem())}),s(25,"Add Item"),o()(),r(26,"div",18)(27,"button",19),_("click",function(){p(e);let t=c();return u(t.cancel())}),s(28,"Cancel"),o(),r(29,"button",20),s(30,"Save"),o()()()}if(a&2){let e=c();m(4),y("ngModel",e.requestType),m(12),y("ngModel",e.selectedEmployee),m(3),d("ngForOf",e.activeEmployees),m(4),d("ngForOf",e.items),m(6),d("disabled",e.loading)}}var Q=class a{constructor(i,e,n,t){this.router=i;this.requestService=e;this.employeeService=n;this.workflowService=t;let x=this.router.getCurrentNavigation()?.extras?.state;x?.employeeId&&x?.employeeEmail&&(this.selectedEmployee=x.employeeEmail)}requestType="Leave";selectedEmployee="";items=[{name:"",quantity:1}];error=null;loading=!1;activeEmployees=[];newDepartment="";ngOnInit(){this.loadActiveEmployees()}loadActiveEmployees(){this.loading=!0,this.employeeService.getAllEmployees().subscribe({next:i=>{this.activeEmployees=i.filter(e=>e.status==="Active"),this.loading=!1},error:i=>{this.error="Error loading employees: "+i.message,this.loading=!1}})}addItem(){this.items.push({name:"",quantity:1})}removeItem(i){this.items.length>1&&this.items.splice(i,1)}getWorkflowType(i){switch(i){case"Equipment":return"Request Equipment Approval";case"Leave":return"Request Leave Approval";case"Resources":return"Request Resources Approval";default:return"Request Equipment Approval"}}save(){if(!this.requestType||!this.selectedEmployee||this.items.some(n=>!n.name)){this.error="Please fill in all required fields";return}let i=this.activeEmployees.find(n=>n.email===this.selectedEmployee);if(!i){this.error="Selected employee not found";return}let e={type:this.requestType,employeeId:i.id,employeeEmail:i.email,items:this.items.map(n=>`${n.name} (${n.quantity})`).join(", "),status:"Pending"};this.loading=!0,this.requestService.createRequest(e).subscribe({next:n=>{let t="";this.requestType==="Department Transfer"?t=`Transfer from ${i.department} to ${this.newDepartment}`:this.requestType==="Equipment"||this.requestType==="Resources"?t=`Requesting ${this.requestType} Approval`:this.requestType==="Leave"?t="Leave Request Approval":t=`${this.requestType} Process`,this.workflowService.createWorkflow({employee_id:i.id,request_id:n.id,current_step:t,status:"Pending",request_type:this.requestType,request_items:e.items}).subscribe({next:()=>{this.router.navigate(["/requests"])},error:l=>{this.error="Error creating workflow: "+l.message,this.loading=!1}})},error:n=>{this.error="Error saving request: "+n.message,this.loading=!1}})}cancel(){this.router.navigate(["/requests"])}static \u0275fac=function(e){return new(e||a)(g(M),g(z),g(j),g(B))};static \u0275cmp=h({type:a,selectors:[["app-add-request"]],decls:7,vars:3,consts:[[1,"card"],[1,"card-header"],["class","alert alert-danger",4,"ngIf"],["class","loading-spinner",4,"ngIf"],["class","form",3,"ngSubmit",4,"ngIf"],[1,"alert","alert-danger"],[1,"loading-spinner"],[1,"form",3,"ngSubmit"],[1,"form-group"],["name","type","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","Leave"],["value","Resources"],["value","Equipment"],["name","employee","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","item-row",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-secondary","mt-2",3,"click"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[3,"value"],[1,"item-row"],["type","text","placeholder","Item Name","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","number","placeholder","Quantity","min","1","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"h2"),s(3,"Add Request"),o()(),f(4,$,2,1,"div",2)(5,G,2,0,"div",3)(6,U,31,5,"form",4),o()),e&2&&(m(4),d("ngIf",n.error),m(),d("ngIf",n.loading),m(),d("ngIf",!n.loading))},dependencies:[S,w,E,F,k,W,N,R,I,V,O,A,D,L,T,P],styles:[".card[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:1.5rem 2rem;background:#fff;border-radius:16px;box-shadow:0 4px 20px #0000001a}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;color:#333}.form[_ngcontent-%COMP%]{padding:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.form-control[_ngcontent-%COMP%]{display:block;width:100%;padding:.375rem .75rem;font-size:1rem;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control[_ngcontent-%COMP%]:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 .2rem #007bff40}.item-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:.5rem;align-items:flex-start}.item-row[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{flex:1}.item-row[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:120px;flex:0 0 auto}.btn[_ngcontent-%COMP%]{display:inline-block;font-weight:400;text-align:center;vertical-align:middle;-webkit-user-select:none;user-select:none;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.btn-primary[_ngcontent-%COMP%]{color:#fff;background-color:#007bff;border:1px solid #007bff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3;border-color:#0056b3}.btn-secondary[_ngcontent-%COMP%]{color:#fff;background-color:#6c757d;border:1px solid #6c757d}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#5a6268;border-color:#545b62}.btn-danger[_ngcontent-%COMP%]{color:#fff;background-color:#dc3545;border:1px solid #dc3545}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c82333;border-color:#bd2130}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:2rem;padding-top:1rem;border-top:1px solid #dee2e6}.alert[_ngcontent-%COMP%]{padding:.75rem 1.25rem;margin-bottom:1rem;border:1px solid transparent;border-radius:.25rem}.alert-danger[_ngcontent-%COMP%]{color:#721c24;background-color:#f8d7da;border-color:#f5c6cb}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:2rem;font-size:1.1rem;color:#6c757d}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}"]})};export{Q as AddRequestComponent};
